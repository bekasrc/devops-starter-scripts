#!/bin/bash
# ==============================================================
# Скрипт для создания резервной копии указанной директории
# Использование: ./backup_project.sh <ПАПКА_ДЛЯ_КОПИРОВАНИЯ>
# ==============================================================

# 1. Переменные для логирования и имен файлов
SOURCE_DIR=$1                      # $1 - это первый аргумент, который пользователь передаст скрипту
BACKUP_DIR="/tmp/backups"          # Место, куда будут сохраняться копии
DATE=$(date +%Y%m%d_%H%M%S)        # Формат даты: ГГГГММДД_ЧЧММСС
TAR_FILE="$BACKUP_DIR/$SOURCE_DIR-$DATE.tar.gz" # Полное имя архива

# 2. Проверка входных данных (Условные операторы IF/ELSE)
# Проверяем, передал ли пользователь аргумент (имя папки)
if [ -z "$SOURCE_DIR" ]; then
    echo "Ошибка: Пожалуйста, укажите папку для резервного копирования."
    echo "Пример использования: $0 /path/to/my/folder"
    exit 1 # Код ошибки 1
fi

# Проверяем, существует ли указанная папка
if [ ! -d "$SOURCE_DIR" ]; then
    echo "Ошибка: Директория $SOURCE_DIR не существует."
    exit 1 # Код ошибки 1
fi

# 3. Основное действие: Создание резервной копии
echo "---"
echo "Создание папки для бэкапов: $BACKUP_DIR"
mkdir -p "$BACKUP_DIR" # Создает папку, если ее нет (-p)

echo "Создание резервной копии $SOURCE_DIR в $TAR_FILE..."
# tar: создаем архив (c), gzip-сжатие (z), файл (f)
tar -czf "$TAR_FILE" "$SOURCE_DIR"

# 4. Проверка успешности операции
if [ $? -eq 0 ]; then
    echo "---"
    echo "УСПЕХ: Резервная копия успешно создана:"
    echo "Размер: $(du -sh "$TAR_FILE" | awk '{print $1}')"
    echo "Полный путь: $TAR_FILE"
    echo "---"
else
    echo "---"
    echo "ПРОВАЛ: Не удалось создать резервную копию."
    echo "---"
    exit 1
fi

exit 0 # Код успешного выполнения
